; Lab 6
; Raj Joshi & Arihant Gupta
; 5/22/19

#include <p16f887.inc>

	ORG 0
	GOTO main
	ORG 4
	GOTO isr

main:
	BANKSEL OPTION_REG
	BCF OPTION_REG, 7
	BANKSEL TRISB
	MOVLW b'00001111' ;4-7 are outputs (rows) 0-3 are inputs (columns)
	MOVWF TRISB
	BANKSEL WPUB
	MOVWF WPUB
	BANKSEL ANSEL
	CLRF ANSEL
	BANKSEL TRISD
	CLRF TRISD	
	BANKSEL PORTB
	MOVLW 0xFF
	MOVWF PORTB
	BANKSEL PORTD
	CLRF PORTD

test_keys:;common anode, msb-1 is g lsb is a
	BCF PORTB, 7 ;testing column 1
	BTFSS PORTB, 3 
	MOVLW b'11001111';0x01
	BTFSS PORTB, 2
	MOVLW b'10011001';0x04
	BTFSS PORTB, 1
	MOVLW b'11111000';0x07
	BTFSS PORTB, 0
	MOVLW b'11000000';0x00
	BSF PORTB, 7
	
	BCF PORTB, 6 ;testing column 2
	BTFSS PORTB, 3
	MOVLW b'10100100';0x02
	BTFSS PORTB, 2
	MOVLW b'10010010';0x05
	BTFSS PORTB, 1
	MOVLW b'10000000'
	BTFSS PORTB, 0
	MOVLW b'10001110';0x0F
	BSF PORTB, 6

	BCF PORTB, 5 ;testing column 3
	BTFSS PORTB, 3
	MOVLW b'10110000';0x03
	BTFSS PORTB, 2
	MOVLW b'10000010';0x06
	BTFSS PORTB, 1
	MOVLW b'10011000';0x09
	BTFSS PORTB, 0
	MOVLW b'10000110';0x0E
	BSF PORTB, 5

	BCF PORTB, 4 ;testing column 4
	BTFSS PORTB, 3
	MOVLW b'10001000';0x0A
	BTFSS PORTB, 2
	MOVLW b'10000011';0x0B
	BTFSS PORTB, 1
	MOVLW b'11000110';0x0C
	BTFSS PORTB, 0
	MOVLW b'10100001';0x0D
	BSF PORTB, 4

	MOVWF PORTD
	GOTO test_keys

isr:
	NOP
	RETFIE

	END
	